<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For Appiiii ‚ù§Ô∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Montserrat:wght@300;400;700&family=Dancing+Script:wght@700&family=Sacramento&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --primary-red: #ff0037; --paper-color: #fff9e6; --soft-pink: #fff0f3; --dark-bg: #1a0000; }
        body, html { margin: 0; padding: 0; min-height: 100%; font-family: 'Montserrat', sans-serif; background: var(--soft-pink); color: #333; overflow-x: hidden; scroll-behavior: smooth; }
        
        /* Floating Hearts Background */
        .heart-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; overflow: hidden; }
        .bg-heart { position: absolute; color: rgba(255, 0, 55, 0.1); font-size: 20px; animation: float 10s linear infinite; }
        @keyframes float { 0% { transform: translateY(100vh) rotate(0deg); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; } }

        /* --- Vault Styling --- */
        #vault-screen { height: 100vh; display: flex; justify-content: center; align-items: center; background: radial-gradient(circle, #2b0000 0%, #000000 100%); z-index: 2000; position: fixed; top:0; left:0; width:100%; }
        .vault-container { background: rgba(255, 255, 255, 0.07); backdrop-filter: blur(20px); padding: 50px 40px; border-radius: 30px; text-align: center; border: 1px solid rgba(255,255,255,0.15); width: 340px; color: white; position: relative; }
        .close-vault { position: absolute; top: 20px; right: 25px; cursor: pointer; font-size: 1.5rem; opacity: 0.5; color: white; }
        .display { font-size: 2rem; letter-spacing: 5px; margin: 25px 0; color: var(--primary-red); font-weight: bold; }
        .keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .key { background: rgba(255,255,255,0.1); border: none; color: white; padding: 18px; border-radius: 15px; font-size: 1.3rem; cursor: pointer; }

        /* --- Main Content --- */
        #main-content { display: none; flex-direction: column; align-items: center; width: 100%; position: relative; z-index: 10; padding-bottom: 50px; }
        
        /* Hero Section */
        .hero-section { height: 100vh; width: 100%; display: flex; justify-content: center; align-items: center; background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1518199266791-5375a83190b7?q=80&w=2070&auto=format&fit=crop'); background-size: cover; background-attachment: fixed; color: white; text-align: center; }
        .hero-card { background: rgba(43, 14, 14, 0.85); border: 1px solid rgba(255, 77, 109, 0.3); border-radius: 40px; padding: 60px; max-width: 550px; width: 90%; }
        .script-name { font-family: 'Great Vibes', cursive; font-size: 5rem; margin: 10px 0; }
        .timer-digits { font-family: monospace; font-size: 1.8rem; color: #ffccd5; }

        /* General Section Styling */
        section { width: 100%; padding: 80px 20px; text-align: center; box-sizing: border-box; background: white; }
        h2.script-title { font-family: 'Great Vibes', cursive; font-size: 3.5rem; color: #333; margin-bottom: 20px; }

        /* --- Envelope Section --- */
        .envelope { width: 180px; height: 120px; background: #ff0037; margin: 40px auto; border-radius: 0 0 10px 10px; cursor: pointer; position: relative; transition: 0.4s; }
        .envelope::before { content: ""; position: absolute; top: -100px; left: 0; border-left: 90px solid transparent; border-right: 90px solid transparent; border-bottom: 100px solid #ff1a4d; }
        .heart-seal { position: absolute; top: 30%; left: 50%; transform: translate(-50%, -50%); font-size: 2.5rem; animation: beat 1.5s infinite; }

        /* --- 3x2 Photo Grid --- */
        .polaroid-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; max-width: 1000px; margin: 40px auto; }
        .flip-card { height: 350px; perspective: 1000px; }
        .flip-card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.8s; transform-style: preserve-3d; }
        .flip-card:hover .flip-card-inner { transform: rotateY(180deg); }
        .flip-card-front, .flip-card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .flip-card-front { background: white; padding: 15px; border: 1px solid #eee; }
        .flip-card-front img { width: 100%; height: 260px; object-fit: cover; border-radius: 5px; }
        .flip-card-back { background: var(--soft-pink); transform: rotateY(180deg); display: flex; align-items: center; justify-content: center; padding: 20px; font-family: 'Dancing Script'; font-size: 1.5rem; text-align: center; }

        /* --- Love Booth Section --- */
        .booth-section { background: #fff5f8; padding: 60px 20px; }
        .mode-toggles { display: flex; justify-content: center; gap: 15px; margin-bottom: 30px; }
        .toggle-btn { padding: 10px 20px; border: 1px solid #ccc; background: white; border-radius: 5px; cursor: pointer; font-weight: bold; color: #555; transition: 0.3s; }
        .toggle-btn.active { background: #ff0037; color: white; border-color: #ff0037; }
        .booth-ui { display: flex; flex-direction: row; justify-content: center; align-items: flex-start; gap: 40px; max-width: 900px; margin: 0 auto; flex-wrap: wrap; }
        .booth-preview-area { background: #333; border-radius: 15px; padding: 15px; box-shadow: 0 15px 35px rgba(0,0,0,0.2); position: relative; width: 320px; min-height: 240px; display: flex; justify-content: center; align-items: center; overflow: hidden; border: 3px solid #555; }
        .camera-feed { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); border-radius: 10px; }
        .strip-result-container, .single-result-container { display: none; flex-direction: column; align-items: center; background: #ff0037; padding: 10px; border-radius: 5px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); }
        .strip-result-container { width: 120px; }
        .single-result-container { width: 280px; padding: 15px; }
        .strip-photo { width: 100px; height: 75px; background: white; object-fit: cover; margin-bottom: 8px; border: 2px solid white; }
        .single-photo { width: 250px; height: 250px; background: white; object-fit: cover; border: 5px solid white; border-radius: 10px; }
        .strip-footer { color: white; font-family: 'Dancing Script', cursive; font-size: 0.8rem; margin-top: 5px; }
        .controls-container { display: flex; flex-direction: column; align-items: center; gap: 15px; width: 100%; }
        .shutter-btn { width: 70px; height: 70px; border-radius: 50%; background: #ff0037; border: 4px solid white; box-shadow: 0 0 0 4px #ff0037, 0 10px 20px rgba(0,0,0,0.2); cursor: pointer; transition: 0.2s; display: flex; justify-content: center; align-items: center; color: white; font-weight: bold; margin-top: 20px; }
        .shutter-btn:active { transform: scale(0.95); }
        .action-buttons { display: none; gap: 15px; margin-top: 20px; }
        .action-btn { padding: 10px 25px; border-radius: 5px; border: none; cursor: pointer; font-weight: bold; font-size: 0.9rem; color: white; width: 120px; }
        .retake-btn { background: #ff0037; }
        .save-btn { background: #333; }

        /* --- Why I Love You (ENHANCED) --- */
        .love-reason-box { 
            background: white; padding: 50px; border-radius: 30px; 
            max-width: 700px; margin: 40px auto; 
            box-shadow: 0 15px 40px rgba(255, 0, 55, 0.1); 
            display: none; border: 2px solid #fff0f3;
            font-family: 'Dancing Script', cursive; font-size: 1.6rem; 
            line-height: 1.8; color: #444; position: relative;
        }
        .love-reason-box::before { content: "üíñ"; position: absolute; top: -25px; left: 50%; transform: translateX(-50%); font-size: 3rem; }

        /* --- Open When Letters --- */
        .letters-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 25px; max-width: 1000px; margin: 40px auto; }
        .letter-card { background: white; padding: 20px; border-radius: 5px; border: 2px dashed #a2d2ff; cursor: pointer; transition: 0.3s; position: relative; display: flex; flex-direction: column; justify-content: space-between; height: 150px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .letter-card:hover { transform: translateY(-5px); border-color: var(--primary-red); }
        .card-top { display: flex; justify-content: space-between; align-items: start; }
        .to-text { font-size: 0.7rem; color: #999; font-family: sans-serif; text-align: left; line-height: 1.4; }
        .heart-stamp { font-size: 1.2rem; color: #ffccd5; opacity: 0.8; }
        .card-title { font-family: 'Great Vibes', cursive; font-size: 1.8rem; color: #333; margin: 5px 0; }
        .open-btn-style { background: transparent; border: 1px solid #333; color: #333; padding: 5px 15px; font-size: 0.6rem; letter-spacing: 1px; border-radius: 20px; align-self: center; text-transform: uppercase; }

        /* --- Countdown & Plans --- */
        .countdown-container { background: #330000; color: white; padding: 60px 20px; }
        .countdown-timer { display: flex; justify-content: center; gap: 30px; font-family: 'Montserrat'; margin-bottom: 50px; }
        .time-box div { font-size: 3rem; font-weight: bold; }
        .time-box span { font-size: 0.8rem; letter-spacing: 2px; }
        .plans-grid { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; max-width: 1000px; margin: 0 auto; }
        .plan-card { background: rgba(255,255,255,0.05); padding: 20px 30px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1); width: 280px; }

        /* --- Will You Be My Valentine --- */
        .valentine-ask { padding: 100px 20px; background: #fff0f5; }
        .bear-img { width: 300px; margin-bottom: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .btn-group { margin-top: 30px; }
        .yes-btn { background: #ff0037; color: white; padding: 15px 40px; font-size: 1.2rem; border: none; border-radius: 50px; cursor: pointer; margin: 0 10px; transition: 0.3s; }
        .yes-btn:hover { transform: scale(1.1); }
        .no-btn { background: #ccc; color: white; padding: 15px 40px; font-size: 1.2rem; border: none; border-radius: 50px; cursor: pointer; margin: 0 10px; }

        /* --- Modals --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 3000; justify-content: center; align-items: center; }
        .modal-content { background: var(--paper-color); padding: 40px; width: 90%; max-width: 500px; border-radius: 10px; text-align: center; font-family: 'Dancing Script', cursive; font-size: 1.3rem; position: relative; line-height: 1.6; }
        .close-modal { position: absolute; top: 10px; right: 20px; font-size: 2rem; cursor: pointer; font-family: sans-serif; }

        /* Music Player Visual */
        .music-player { position: fixed; bottom: 20px; left: 20px; background: white; padding: 10px 20px; border-radius: 50px; display: flex; align-items: center; gap: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); z-index: 999; opacity: 0; transition: opacity 1s; }
        .play-icon { width: 30px; height: 30px; background: #330000; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: white; font-size: 0.8rem; cursor: pointer; }

        /* --- FINAL FULL SCREEN OVERLAY --- */
        #final-overlay {
            display: none; /* Hidden initially */
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            /* Make sure forever.JPG is in the folder! */
            background: url('forever.JPG') no-repeat center center/cover; 
            z-index: 10000; /* Top priority */
            justify-content: center; align-items: center;
        }
        .final-text-box {
            background: rgba(0, 0, 0, 0.4); /* Dark see-through box for text */
            padding: 40px; border-radius: 20px; text-align: center; color: white;
            backdrop-filter: blur(5px); border: 2px solid rgba(255, 255, 255, 0.3);
            animation: popIn 1s ease;
        }
        .final-title { font-family: 'Great Vibes', cursive; font-size: 4rem; margin: 0 0 20px 0; text-shadow: 2px 2px 5px rgba(0,0,0,0.5); }
        .final-subtitle { font-family: 'Montserrat', sans-serif; font-size: 1.5rem; letter-spacing: 3px; text-transform: uppercase; }
        @keyframes popIn { 0% { opacity: 0; transform: scale(0.8); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes beat { 0%, 100% { transform: translate(-50%, -50%) scale(1); } 50% { transform: translate(-50%, -50%) scale(1.2); } }
    </style>
</head>
<body onload="initHearts()">

    <div class="heart-bg" id="bg-hearts"></div>
    
    <audio id="bg-music" loop>
        <source src="perfect song.mp3" type="audio/mp3">
    </audio>

    <div class="music-player" id="music-ui">
        <div class="play-icon" onclick="toggleMusic()">üéµ</div>
        <div style="font-size: 0.8rem;">Love Song - Playing for you</div>
    </div>

    <div id="final-overlay">
        <div class="final-text-box">
            <h1 class="final-title">You and me are a forever thing</h1>
            <p class="final-subtitle">I lovee youu too moon and backkk ‚ù§Ô∏è</p>
        </div>
    </div>

    <div id="vault-screen">
        <div class="vault-container">
            <span class="close-vault" onclick="location.reload()">‚úñ</span>
            <h2 style="margin:0; font-family: 'Great Vibes'; font-size: 2.5rem;">The Vault</h2>
            <p style="opacity: 0.6; font-size: 0.8rem;">Enter Secret Date</p>
            <div class="display" id="pass-display">_ _ _ _ _ _ _ _</div>
            <div class="keypad" id="keypad"></div>
            <div class="unlock-msg" style="margin-top:20px; color:#ffccd5;">Unlock my heart ‚ù§Ô∏è</div>
        </div>
    </div>

    <div id="main-content">
        
        <section class="hero-section">
            <div class="hero-card">
                <div style="color: #ffcc00; font-weight: bold; letter-spacing: 2px;">HAPPY VALENTINE'S DAY</div>
                <div class="script-name">Appiiii</div>
                <div style="font-style: italic; margin-bottom: 30px;">"My heart beats only for you."</div>
                <button class="yes-btn" onclick="showerLove()">‚ù§Ô∏è Shower me with Love</button>
                <div style="margin-top: 40px;">
                    <div style="font-size: 0.7rem; letter-spacing: 3px; opacity: 0.7; margin-bottom: 10px;">WE'VE BEEN IN LOVE FOR</div>
                    <div class="timer-digits" id="love-counter">0d 0h 0m 0s</div>
                </div>
            </div>
        </section>

        <section>
            <h2 class="script-title">Read my heart...</h2>
            <div class="envelope" onclick="openModal('main-letter')"><div class="heart-seal">‚ù§Ô∏è</div></div>
            <p style="color: #888; margin-top: 20px;">Tap to open</p>
        </section>

        <section>
            <span style="border: 1px solid #ffccd5; padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; color: #ff0037;">üå∏ OUR MEMORIES üå∏</span>
            <h2 class="script-title" style="margin-top: 10px;">Captured Moments</h2>
            <div class="polaroid-grid">
                <div class="flip-card"><div class="flip-card-inner"><div class="flip-card-front"><img src="pic 1.jpeg"><span>First Sight</span></div><div class="flip-card-back">"Your smile is my home."</div></div></div>
                <div class="flip-card"><div class="flip-card-inner"><div class="flip-card-front"><img src="pic 2.jpeg"><span>Laughter</span></div><div class="flip-card-back">"Every second matters."</div></div></div>
                <div class="flip-card"><div class="flip-card-inner"><div class="flip-card-front"><img src="pic 3.jpeg"><span>Adventures</span></div><div class="flip-card-back">"Better together."</div></div></div>
                <div class="flip-card"><div class="flip-card-inner"><div class="flip-card-front"><img src="pic 4.jpeg"><span>My Love</span></div><div class="flip-card-back">"My favorite thought."</div></div></div>
                <div class="flip-card"><div class="flip-card-inner"><div class="flip-card-front"><img src="pic 5.jpeg"><span>Sweetness</span></div><div class="flip-card-back">"Forever yours."</div></div></div>
                <div class="flip-card"><div class="flip-card-inner"><div class="flip-card-front"><img src="couple.png.jpeg"><span>Us</span></div><div class="flip-card-back">"My heart is full."</div></div></div>
            </div>
        </section>

        <section class="booth-section">
            <h2 class="script-title">Love Booth üì∏</h2>
            <p>Capture a moment for us!</p>
            
            <div class="mode-toggles">
                <div class="toggle-btn" id="btn-single" onclick="setMode('single')">üì∑ Single Shot</div>
                <div class="toggle-btn active" id="btn-strip" onclick="setMode('strip')">üéûÔ∏è Photo Strip</div>
                <div class="toggle-btn" onclick="document.getElementById('gallery-upload').click()">üñºÔ∏è From Gallery</div>
            </div>
            <input type="file" id="gallery-upload" accept="image/*" multiple hidden>

            <div class="booth-ui">
                <div class="booth-preview-area">
                    <video id="hidden-video" class="camera-feed" autoplay></video>
                    <div id="strip-result" class="strip-result-container">
                        <canvas id="canvas1" class="strip-photo"></canvas>
                        <canvas id="canvas2" class="strip-photo"></canvas>
                        <canvas id="canvas3" class="strip-photo"></canvas>
                        <div class="strip-footer">Happy Valentine's Day!</div>
                    </div>
                    <div id="single-result" class="single-result-container">
                        <canvas id="canvas-single" class="single-photo"></canvas>
                        <div class="strip-footer" style="font-size: 1.2rem;">‚ù§Ô∏è Love in Focus ‚ù§Ô∏è</div>
                    </div>
                </div>

                <div class="controls-container">
                    <button id="capture-btn" class="shutter-btn" onclick="capture()">CLICK</button>
                    <div class="action-buttons" id="action-btns">
                        <button class="action-btn retake-btn" onclick="resetBooth()">Retake ‚Ü∫</button>
                        <button class="action-btn save-btn" onclick="downloadImage()">Save ‚¨áÔ∏è</button>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h2 class="script-title">Why I Love You</h2>
            <p>Click below to find out...</p>
            <button class="yes-btn" onclick="showLoveReason()">‚ù§Ô∏è Click to Feel Loved</button>
            <div id="love-reason" class="love-reason-box">
                My dearest Appii üíñ, looking back at where we started on that August day in 2022 üóìÔ∏è, I realize that falling for you was the best thing I ever did. You aren't just my girlfriend; you are my peace üïäÔ∏è, my laughter üòÇ, and my safe haven in this chaotic world üåç.<br><br>I love you for the memories we've created üì∏, for the way you understand my silence ü§´, and for the way you make even ordinary days feel magical ‚ú®. But more than the past, I love you for our future üöÄ‚Äîfor the thousands of sunsets we haven‚Äôt seen yet üåÖ, the road trips we haven‚Äôt taken üöó, and the life we are going to build together üè°.<br><br>You are my yesterday, my today, and my forever ‚ôæÔ∏è. I promise to annoy you ü§™, support you ü§ù, and love you endlessly until the very end of time. ‚ù§Ô∏èü•∞
            </div>
        </section>

        <section style="background: #fff0f3;">
            <div style="font-size: 2rem; margin-bottom: 10px;">‚úâÔ∏è</div>
            <h2 class="script-title">Open When...</h2>
            <p style="font-family: sans-serif; color: #666; margin-bottom: 40px;">Little reminders of my love for every mood</p>
            <div class="letters-grid">
                <div class="letter-card" onclick="openModal('miss')"><div class="card-top"><div class="to-text">To: My Love<br><span style="font-size:0.6rem; opacity:0.6;">For every moment</span></div><div class="heart-stamp">‚ù§Ô∏è</div></div><div class="card-title">You Miss Me</div><div class="open-btn-style">Open When</div></div>
                <div class="letter-card" onclick="openModal('sad')"><div class="card-top"><div class="to-text">To: My Love<br><span style="font-size:0.6rem; opacity:0.6;">For every moment</span></div><div class="heart-stamp">‚ù§Ô∏è</div></div><div class="card-title">You're Sad</div><div class="open-btn-style">Open When</div></div>
                <div class="letter-card" onclick="openModal('happy')"><div class="card-top"><div class="to-text">To: My Love<br><span style="font-size:0.6rem; opacity:0.6;">For every moment</span></div><div class="heart-stamp">‚ù§Ô∏è</div></div><div class="card-title">You're Happy</div><div class="open-btn-style">Open When</div></div>
                <div class="letter-card" onclick="openModal('sleep')"><div class="card-top"><div class="to-text">To: My Love<br><span style="font-size:0.6rem; opacity:0.6;">For every moment</span></div><div class="heart-stamp">‚ù§Ô∏è</div></div><div class="card-title">You Can't Sleep</div><div class="open-btn-style">Open When</div></div>
            </div>
        </section>

        <section class="countdown-container">
            <h2 class="script-title" style="color: white; margin-bottom: 40px;">Countdown to Valentine's</h2>
            <div class="countdown-timer">
                <div class="time-box"><div id="cd-days">00</div><span>DAYS</span></div>
                <div class="time-box"><div id="cd-hours">00</div><span>HOURS</span></div>
                <div class="time-box"><div id="cd-mins">00</div><span>MINS</span></div>
            </div>
            <h3 style="letter-spacing: 2px; margin-bottom: 30px;">OUR FUTURE PLANS</h3>
            <div class="plans-grid">
                <div class="plan-card">‚ú® Take a spontaneous road trip with no fixed plan</div>
                <div class="plan-card">‚ú® Have a movie marathon in pajamas</div>
                <div class="plan-card">‚ú® Be each other‚Äôs safe space on bad days</div>
            </div>
        </section>

        <section class="valentine-ask">
            <h2 class="script-title" style="color: #ff0037;">Will you be my Valentine? üåπ</h2>
            <img src="proposal.png" class="bear-img" alt="Valentine Proposal">
            <div class="btn-group">
                <button class="no-btn" onclick="handleNoClick()">No üò¢</button>
                <button class="yes-btn" onclick="confirmValentine()">Yes! üíñ</button>
            </div>
        </section>
    </div>

    <div id="msg-modal" class="modal" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-modal" onclick="closeModal()">√ó</span>
            <div id="modal-text"></div>
        </div>
    </div>

    <script>
        // 1. Vault Logic
        let input = ""; const PASSCODE = "06082022";
        const keypad = document.getElementById('keypad');
        [1,2,3,4,5,6,7,8,9,0].forEach(num => {
            let btn = document.createElement('button'); btn.className = 'key'; btn.innerText = num;
            btn.onclick = () => { if(input.length < 8) { input += num; document.getElementById('pass-display').innerText = input; if(input.length === 8) checkPass(); } };
            keypad.appendChild(btn);
        });
        function checkPass() {
            if(input === PASSCODE) {
                document.getElementById('vault-screen').style.display = 'none';
                document.getElementById('main-content').style.display = 'flex';
                document.getElementById('music-ui').style.opacity = '1'; 
                document.getElementById('bg-music').play().catch(error => console.log("User interaction needed for audio")); 
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#ff0037', '#ffffff'] });
                startTimer(); startCountdown();
                startCamera(); 
            } else { input=""; document.getElementById('pass-display').innerText = "_ _ _ _ _ _ _ _"; alert("Try again!"); }
        }

        // Music Toggle
        function toggleMusic() {
            const music = document.getElementById('bg-music');
            if(music.paused) music.play();
            else music.pause();
        }

        // 2. Love Booth Logic
        let currentMode = 'strip'; 
        let videoStream = null;

        async function startCamera() {
            const video = document.getElementById('hidden-video');
            try {
                videoStream = await navigator.mediaDevices.getUserMedia({ video: true });
                video.srcObject = videoStream;
            } catch (err) { console.log("Camera access denied"); }
        }

        function setMode(mode) {
            currentMode = mode;
            resetBooth();
            document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${mode}`).classList.add('active');
        }

        function capture() {
            if (currentMode === 'strip') { takeStrip(); } else { takeSingle(); }
        }

        function takeSingle() {
            const video = document.getElementById('hidden-video');
            const canvas = document.getElementById('canvas-single');
            const resultDiv = document.getElementById('single-result');
            
            canvas.width = 250; canvas.height = 250;
            const ctx = canvas.getContext('2d');
            ctx.translate(250, 0); ctx.scale(-1, 1);
            ctx.drawImage(video, 0, 0, 250, 250);

            video.style.display = 'none';
            resultDiv.style.display = 'flex';
            showActions();
        }

        function takeStrip() {
            const video = document.getElementById('hidden-video');
            const resultDiv = document.getElementById('strip-result');
            const canvasIds = ['canvas1', 'canvas2', 'canvas3'];
            
            video.style.display = 'block'; 
            resultDiv.style.display = 'none';

            let count = 0;
            const interval = setInterval(() => {
                if(count >= 3) {
                    clearInterval(interval);
                    video.style.display = 'none';
                    resultDiv.style.display = 'flex';
                    showActions();
                    return;
                }
                const canvas = document.getElementById(canvasIds[count]);
                canvas.width = 100; canvas.height = 75;
                const ctx = canvas.getContext('2d');
                ctx.translate(100, 0); ctx.scale(-1, 1);
                ctx.drawImage(video, 0, 0, 100, 75);
                
                document.querySelector('.booth-preview-area').style.opacity = 0.5;
                setTimeout(()=>document.querySelector('.booth-preview-area').style.opacity = 1, 100);
                count++;
            }, 1000);
        }

        function showActions() {
            document.getElementById('capture-btn').style.display = 'none';
            document.getElementById('action-btns').style.display = 'flex';
        }

        function resetBooth() {
            document.getElementById('hidden-video').style.display = 'block';
            document.getElementById('strip-result').style.display = 'none';
            document.getElementById('single-result').style.display = 'none';
            document.getElementById('capture-btn').style.display = 'flex';
            document.getElementById('action-btns').style.display = 'none';
        }

        function downloadImage() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            if (currentMode === 'strip') {
                canvas.width = 140; canvas.height = 380;
                ctx.fillStyle = "#ff0037"; ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = "white"; ctx.font = "bold 12px Montserrat"; ctx.textAlign = "center";
                ctx.fillText("HAPPY VALENTINE'S", 70, 25);

                const c1 = document.getElementById('canvas1');
                const c2 = document.getElementById('canvas2');
                const c3 = document.getElementById('canvas3');

                ctx.fillStyle = "white";
                ctx.fillRect(15, 35, 110, 85); ctx.drawImage(c1, 20, 40, 100, 75);
                ctx.fillRect(15, 130, 110, 85); ctx.drawImage(c2, 20, 135, 100, 75);
                ctx.fillRect(15, 225, 110, 85); ctx.drawImage(c3, 20, 230, 100, 75);

                ctx.font = "10px Dancing Script"; ctx.fillText("Love, Appiiii & Aryan", 70, 340);
                ctx.font = "10px monospace"; ctx.fillText("14.02.2026", 70, 355);
            } else {
                canvas.width = 300; canvas.height = 350;
                ctx.fillStyle = "#ff0037"; ctx.fillRect(0, 0, canvas.width, canvas.height);
                const cSingle = document.getElementById('canvas-single');
                ctx.fillStyle = "white";
                ctx.fillRect(15, 15, 270, 270);
                ctx.drawImage(cSingle, 25, 25, 250, 250);
                ctx.fillStyle = "white"; ctx.font = "20px Dancing Script"; ctx.textAlign = "center";
                ctx.fillText("Love in Focus ‚ù§Ô∏è", 150, 320);
            }

            const link = document.createElement('a');
            link.download = `valentine-${currentMode}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        // Gallery Upload Logic
        document.getElementById('gallery-upload').addEventListener('change', function(e) {
            const files = e.target.files;
            if (files.length > 0) {
                setMode('strip');
                const canvasIds = ['canvas1', 'canvas2', 'canvas3'];
                
                document.getElementById('hidden-video').style.display = 'none';
                document.getElementById('strip-result').style.display = 'flex';
                showActions();

                for(let i=0; i<Math.min(files.length, 3); i++) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const img = new Image();
                        img.onload = function() {
                            const canvas = document.getElementById(canvasIds[i]);
                            canvas.width = 100; canvas.height = 75;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0, 100, 75);
                        }
                        img.src = event.target.result;
                    }
                    reader.readAsDataURL(files[i]);
                }
            }
        });

        // 3. Timers
        function startTimer() {
            const start = new Date("2022-08-06T00:00:00");
            setInterval(() => {
                const diff = new Date() - start;
                const d = Math.floor(diff / (1000 * 60 * 60 * 24));
                const h = Math.floor((diff / (1000 * 60 * 60)) % 24);
                const m = Math.floor((diff / 1000 / 60) % 60);
                const s = Math.floor((diff / 1000) % 60);
                document.getElementById('love-counter').innerText = `${d}d ${h}h ${m}m ${s}s`;
            }, 1000);
        }
        function startCountdown() {
            const valDay = new Date("2026-02-14T00:00:00"); 
            setInterval(() => {
                const diff = valDay - new Date();
                if(diff > 0) {
                    document.getElementById('cd-days').innerText = Math.floor(diff / (1000 * 60 * 60 * 24));
                    document.getElementById('cd-hours').innerText = Math.floor((diff / (1000 * 60 * 60)) % 24);
                    document.getElementById('cd-mins').innerText = Math.floor((diff / 1000 / 60) % 60);
                }
            }, 1000);
        }

        // 4. Modals & Interactions
        const messages = {
            'miss': "<h2>When You Miss Me...</h2><p>Remember that I am always with you in spirit. Close your eyes and feel my hug. I love you! ‚ù§Ô∏è</p>",
            'sad': "<h2>When You're Sad...</h2><p>It's okay to have bad days. Just know that I'm here to listen, to hold you, and to remind you how amazing you are.</p>",
            'happy': "<h2>When You're Happy...</h2><p>Your smile is my favorite thing in the world. Keep shining, my love! ‚ú®</p>",
            'sleep': "<h2>When You Can't Sleep...</h2><p>Imagine us laying under the stars, just talking about everything and nothing. Sweet dreams, my love. üåô</p>",
            'main-letter': "<h2 style='color:#ff0037;'>To My Eternal Arpita üíñ</h2><br><p>My dearest <b>Appii</b>,</p><p>They say a picture is worth a thousand words, but even our favorite photo can't capture how much I adore you. Every time I look into your <b>eyes</b>, I see my entire world. And your <b>smile</b>? It's the only light I ever need to find my way home.</p><p>You are my best friend, my soulmate, and my forever <b>Pankudiii</b>. Even when you're being my adorable <b>Choti Bachii</b>, I find myself falling for you all over again.</p><p>I promise to spend the rest of my life giving you a million kisses.</p><p><b>Happy Valentine's Day, My Love! You are my everything. üåπ</b></p><p>Forever Yours. üíñ</p><div style='text-align:right; margin-top:20px;'>‚Äî Aryan</div>"
        };
        function openModal(type) {
            document.getElementById('modal-text').innerHTML = messages[type];
            document.getElementById('msg-modal').style.display = 'flex';
        }
        function closeModal() { document.getElementById('msg-modal').style.display = 'none'; }
        
        function showerLove() { confetti({ particleCount: 100, spread: 70, origin: { y: 0.8 }, colors: ['#ff0037'] }); }
        
        function showLoveReason() {
            document.getElementById('love-reason').style.display = 'block';
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, colors: ['#ff0037', '#ffffff'] });
        }

        function moveButton(btn) { btn.style.position = 'absolute'; btn.style.top = Math.random()*80 + '%'; btn.style.left = Math.random()*80 + '%'; }
        
        // --- NEW FINAL CONFIRMATION LOGIC ---
        function confirmValentine() {
            // 1. The confirmation dialog
            const isSure = confirm("Are you sure? This action cannot be undone and u would be locked with me forever üîí‚ù§Ô∏è");

            if (isSure) {
                // 2. Show the final screen overlay
                document.getElementById('final-overlay').style.display = 'flex';
                // 3. Massive confetti explosion
                triggerMassiveConfetti();
            }
        }

        // --- NEW NO BUTTON LOGIC ---
        function handleNoClick() {
            alert("maar khana hai terkoo no ka option choose kregii jaa beta dunga hi nahi no krnee ,jaao be a good girl and click on yes");
        }

        function triggerMassiveConfetti() {
            var duration = 3 * 1000;
            var animationEnd = Date.now() + duration;
            var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 20000 };

            function randomInRange(min, max) { return Math.random() * (max - min) + min; }

            var interval = setInterval(function() {
                var timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) { return clearInterval(interval); }
                var particleCount = 50 * (timeLeft / duration);
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
            }, 250);
        }

        function initHearts() {
            const container = document.getElementById('bg-hearts');
            for(let i=0; i<30; i++) {
                let h = document.createElement('div'); h.className = 'bg-heart'; h.innerHTML = '‚ù§Ô∏è';
                h.style.left = Math.random()*100 + 'vw';
                h.style.animationDuration = (Math.random()*5 + 5) + 's';
                h.style.animationDelay = (Math.random()*5) + 's';
                container.appendChild(h);
            }
        }
    </script>
</body>
</html>
